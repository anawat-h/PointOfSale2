import{M as g}from"./Modal.402bdf30.js";import{I as z,D as G}from"./ItemDetail.066c6354.js";import{d as U,m as L,r as y,c as p,_ as V,x as C,w as k,h as S,o as _,b as t,a as I,e as B,n as H,t as v,F as T,D as J,u as A,i as K,j as M,v as q,g as $,p as Q,k as W}from"./index.76ef20d6.js";import{M as Y}from"./ModalReceiptPreview.8df52c7e.js";const Z=U({props:{requestNum:{type:Number,default:0},initialSelectedId:{type:Number,default:void 0},items:{type:Array,default:()=>[]}},components:{Modal:g,ItemDetail:z},setup(e,{emit:o}){L(()=>e.requestNum,(E,n)=>{E>n&&s()});const c=y(void 0),h=p(()=>e.items[c.value]),b=y(!1);function s(){b.value=!0,c.value=e.items.findIndex(E=>E.id===e.initialSelectedId)}function m(){o("select",h.value.id),b.value=!1}return{modalState:b,selectedIndex:c,selectedItem:h,onSubmit:m}}}),x=["onClick"],tt=t("hr",null,null,-1),et={key:1};function ut(e,o,c,h,b,s){const m=S("ItemDetail"),E=S("Modal");return _(),C(E,{shown:e.modalState,"onUpdate:shown":o[2]||(o[2]=n=>e.modalState=n),heading:"\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32"},{body:k(()=>[t("ul",null,[(_(!0),I(T,null,B(e.items,(n,i)=>(_(),I("li",{key:i,onClick:r=>e.selectedIndex=i,class:H({"text-primary":e.selectedIndex===i})},v(n.name),11,x))),128))]),tt,e.selectedItem?(_(),C(m,{key:0,item:e.selectedItem},null,8,["item"])):(_(),I("p",et,"No Item Selected"))]),footer:k(()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:o[0]||(o[0]=n=>e.modalState=!1)},"Close"),t("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=(...n)=>e.onSubmit&&e.onSubmit(...n))},"Select this item")]),_:1},8,["shown"])}const nt=V(Z,[["render",ut]]),ot=U({components:{Modal:g,Dropdown:G,ModalSelectItem:nt,ModalReceiptPreview:Y},setup(){const e=K("datastore"),o=y([]);e.unit.getAllUnits().then(u=>{o.value=u});const c=y([]);e.item.getAllItems().then(u=>{c.value=u});const h=J.now().set({hour:0,minute:0,second:0,millisecond:0}),b=p(()=>h.toFormat("dd/MM/yyyy")),s=y([]),m=p(()=>{let u=0;for(const{itemPrice:a,quantity:d}of s.value)u+=a*d;return u}),E=p(()=>{let u=0;for(const{discountAmount:a}of s.value)u+=a;return u}),n=p(()=>m.value-E.value),i=y(0),r=p(()=>Math.max(n.value-i.value,0)),f=A({requestNum:0,initialSelectedID:void 0,rowIndex:0});function X(u){f.rowIndex=u,f.initialSelectedID=u||u===0?s.value[u].itemID:void 0,f.requestNum++}function R(u){const a=c.value.find(D=>D.id===u);let d=A({itemID:a.id,itemCode:a.code,itemName:a.name,itemUnitName:o.value.find(D=>D.id===a.unitID).name,itemPrice:a.price,quantity:0,discountPercentage:0,discountAmount:p(()=>Math.min(d.discountPercentage/100,1)*(d.itemPrice*d.quantity)),amount:p(()=>d.itemPrice*d.quantity-d.discountAmount)});f.rowIndex!==null&&f.rowIndex!==void 0?s.value[f.rowIndex]=d:s.value.push(d)}const N=p(()=>({details:s.value.map(u=>{var a;return{itemID:u.itemID,itemCode:u.itemCode,itemName:u.itemName,itemUnitName:(a=o.value.find(d=>d.id===c.value.find(D=>D.id===u.itemID).unitID))==null?void 0:a.name,itemPrice:u.itemPrice,quantity:u.quantity,discountAmount:u.discountAmount,discountPercentage:u.discountPercentage,amount:u.amount}}),subtotalBeforeDiscount:m.value,totalItemDiscount:E.value,subtotal:n.value,tradeDiscount:i.value,grandTotal:r.value}));function P(){for(const u of s.value)if(!u.quantity)return alert("quantity is empty"),!1;return!0}const w=A({requestNum:0,receipt:void 0});function j(){!P()||(w.receipt={...N.value,docNo:"TXXXX",date:h,id:void 0},w.requestNum++)}function F(){!P()||e.receipt.addReceipt(N.value).then(async()=>{s.value=[]}).catch(u=>alert(u))}function O(u){s.value.splice(u,1)}return{items:c,todayText:b,detailItems:s,subtotalBeforeDiscount:m,totalItemDiscount:E,subtotal:n,tradeDiscount:i,grandTotal:r,modalSelectItem:f,openModalSelectItem:X,onSelectItem:R,modalView:w,openModalPreview:j,onSubmit:F,onDelete:O}}});const l=e=>(Q("data-v-050bb77b"),e=e(),W(),e),lt=l(()=>t("h2",null,"\u0E2D\u0E2D\u0E01\u0E43\u0E1A\u0E40\u0E2A\u0E23\u0E47\u0E08\u0E23\u0E31\u0E1A\u0E40\u0E07\u0E34\u0E19",-1)),st=l(()=>t("div",{class:"row"},[t("div",{class:"col-md-3"},[t("label",null,"\u0E40\u0E25\u0E02\u0E17\u0E35\u0E48\u0E40\u0E2D\u0E01\u0E2A\u0E32\u0E23"),t("br"),t("input",{type:"text",value:"TXXXX",disabled:""})])],-1)),it={class:"row"},at={class:"col-md-3"},dt=l(()=>t("label",null,"\u0E27\u0E31\u0E19\u0E17\u0E35\u0E48",-1)),Et=l(()=>t("br",null,null,-1)),ct=["value"],mt={class:"table-detail"},rt=l(()=>t("thead",null,[t("tr",null,[t("th",{width:"5%"},"No."),t("th",{width:"15%"},"\u0E23\u0E2B\u0E31\u0E2A\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32"),t("th",{width:"15%"},"\u0E0A\u0E37\u0E48\u0E2D\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32"),t("th",{width:"5%"},"\u0E2B\u0E19\u0E48\u0E27\u0E22"),t("th",{width:"5%"},"\u0E08\u0E33\u0E19\u0E27\u0E19"),t("th",{width:"15%"},"\u0E23\u0E32\u0E04\u0E32"),t("th",{width:"10%"},"\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14 (%)"),t("th",{width:"10%"},"\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14 (\u0E1A\u0E32\u0E17)"),t("th",{width:"20%"},"\u0E23\u0E27\u0E21\u0E40\u0E07\u0E34\u0E19"),t("th",{width:"5%"},"\u0E14\u0E33\u0E40\u0E19\u0E34\u0E19\u0E01\u0E32\u0E23")])],-1)),pt={id:"tbody"},vt=["onClick"],_t=["onUpdate:modelValue"],ht=["onUpdate:modelValue"],bt={class:"text-center"},ft=["onClick"],yt=l(()=>t("td",null,null,-1)),It=l(()=>t("td",null,null,-1)),Dt=l(()=>t("td",null,[t("input",{type:"number",disabled:"",value:0})],-1)),St=l(()=>t("td",null,"0",-1)),wt=l(()=>t("td",null,[t("input",{type:"number",disabled:"",value:0})],-1)),At=l(()=>t("td",null,[t("input",{type:"number",disabled:"",value:0})],-1)),Mt=l(()=>t("td",null,"0",-1)),qt=l(()=>t("td",{class:"text-center"},[t("button",{disabled:""},"\u0E25\u0E1A")],-1)),Nt={class:"summary"},Pt={class:"field"},Ct=l(()=>t("span",null,"\u0E22\u0E2D\u0E14\u0E23\u0E27\u0E21\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32\u0E01\u0E48\u0E2D\u0E19\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14",-1)),kt=["value"],$t={class:"field"},gt=l(()=>t("span",null,"\u0E22\u0E2D\u0E14\u0E23\u0E27\u0E21\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32",-1)),Ut=["value"],Vt={class:"field"},Bt=l(()=>t("span",null,"Subtotal",-1)),Tt=["value"],Xt={class:"field"},Rt=l(()=>t("span",null,"\u0E2A\u0E48\u0E27\u0E19\u0E25\u0E14\u0E01\u0E32\u0E23\u0E04\u0E49\u0E32",-1)),jt={class:"field"},Ft=l(()=>t("span",null,"Grand total",-1)),Ot=["value"],zt={class:"d-flex justify-content-end"};function Gt(e,o,c,h,b,s){const m=S("ModalSelectItem"),E=S("ModalReceiptPreview");return _(),I("div",null,[lt,st,t("div",it,[t("div",at,[dt,Et,t("input",{type:"text",value:e.todayText,disabled:""},null,8,ct)])]),t("table",mt,[rt,t("tbody",pt,[(_(!0),I(T,null,B(e.detailItems,(n,i)=>(_(),I("tr",{key:i},[t("td",null,v(i+1),1),t("td",null,[t("button",{onClick:r=>e.openModalSelectItem(i)},v(n.itemCode),9,vt)]),t("td",null,v(n.itemName),1),t("td",null,v(n.itemUnitName),1),t("td",null,[M(t("input",{type:"number","onUpdate:modelValue":r=>n.quantity=r},null,8,_t),[[q,n.quantity]])]),t("td",null,v(n.itemPrice),1),t("td",null,[M(t("input",{type:"number","onUpdate:modelValue":r=>n.discountPercentage=r},null,8,ht),[[q,n.discountPercentage]])]),t("td",null,v(n.discountAmount),1),t("td",null,v(n.amount),1),t("td",bt,[t("button",{onClick:r=>e.onDelete(i)},"\u0E25\u0E1A",8,ft)])]))),128)),t("tr",null,[t("td",null,v(e.detailItems.length+1),1),t("td",null,[t("button",{onClick:o[0]||(o[0]=n=>e.openModalSelectItem(null))},"\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E2A\u0E34\u0E19\u0E04\u0E49\u0E32")]),yt,It,Dt,St,wt,At,Mt,qt])])]),t("div",Nt,[t("div",Pt,[Ct,t("input",{disabled:"",value:e.subtotalBeforeDiscount},null,8,kt)]),t("div",$t,[gt,t("input",{disabled:"",value:e.totalItemDiscount},null,8,Ut)]),t("div",Vt,[Bt,t("input",{disabled:"",value:e.subtotal},null,8,Tt)]),t("div",Xt,[Rt,M(t("input",{type:"number","onUpdate:modelValue":o[1]||(o[1]=n=>e.tradeDiscount=n)},null,512),[[q,e.tradeDiscount]])]),t("div",jt,[Ft,t("input",{disabled:"",value:e.grandTotal},null,8,Ot)])]),t("div",zt,[t("button",{onClick:o[2]||(o[2]=(...n)=>e.openModalPreview&&e.openModalPreview(...n))},"\u0E14\u0E39\u0E15\u0E31\u0E27\u0E2D\u0E22\u0E48\u0E32\u0E07"),t("button",{onClick:o[3]||(o[3]=(...n)=>e.onSubmit&&e.onSubmit(...n))},"\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01")]),$(m,{items:e.items,"request-num":e.modalSelectItem.requestNum,"initial-selected-id":e.modalSelectItem.initialSelectedID,onSelect:e.onSelectItem},null,8,["items","request-num","initial-selected-id","onSelect"]),$(E,{"request-num":e.modalView.requestNum,receipt:e.modalView.receipt},null,8,["request-num","receipt"])])}const Qt=V(ot,[["render",Gt],["__scopeId","data-v-050bb77b"]]);export{Qt as default};
